<!DOCTYPE html>
<html>
	<head>
		<title>Zoomable Canvas with Lines Between Points</title>
		<script src="https://d3js.org/d3.v6.min.js"></script>
		<script src="https://mrdoob.github.io/stats.js/build/stats.min.js"></script>
		<style>
			#plotCanvas {
				border: 1px solid #000;
			}
			#spectrumCanvas {
				border: 1px solid #000;
			}
			#container {
				width: 1000px;
				margin: 0 auto;
				background-color: black;
			}
		</style>
	</head>
	<body>
		<div id="container">
			<canvas id="plotCanvas" width="1000" height="200"></canvas>
			<canvas id="spectrumCanvas" width="1000" height="600"></canvas>
		</div>
		<script>
			window.addEventListener("load", async function () {
				const plotCanvas = document.getElementById("plotCanvas");
				const offscreenPlotCanvas = plotCanvas.transferControlToOffscreen();
				const worker = new Worker("offscreen_worker.js");

				// Post the offscreen canvas and points to the worker
				worker.postMessage({ type: "plotCanvas", canvas: offscreenPlotCanvas }, [
					offscreenPlotCanvas,
				]);

				const spectrumCanvas = document.getElementById("spectrumCanvas");
				const offscreenSpectrumCanvas = spectrumCanvas.transferControlToOffscreen();
				worker.postMessage(
					{ type: "spectrumCanvas", canvas: offscreenSpectrumCanvas },
					[offscreenSpectrumCanvas]
				);

				const update = setInterval(() => {
					worker.postMessage({ type: "update" });
				}, 100);

				// FPS tracking
				const fpsDisplay = document.createElement("div"); // Display element for FPS
				fpsDisplay.style.width = "100px";
				fpsDisplay.style.height = "50px";
				fpsDisplay.style.position = "absolute";
				fpsDisplay.style.top = "0px";
				fpsDisplay.style.left = "0px";
				fpsDisplay.style.color = "white";
				fpsDisplay.style.fontSize = "20px";
				fpsDisplay.style.fontFamily = "Arial";
				fpsDisplay.style.textAlign = "center";
				fpsDisplay.style.backgroundColor = "black";
				document.body.appendChild(fpsDisplay);
				worker.addEventListener("message", (event) => {
					if (event.data.type === "fps") {
						fpsDisplay.innerHTML = event.data.fps.toFixed(2) + " FPS";
					}
				});
			});
		</script>
	</body>
</html>
